{"version":3,"file":"public/js/app.js","sources":["app/initialize.coffee","app/lib/ajax.coffee","app/lib/api.coffee","app/lib/first_timer.coffee","app/lib/regexp_quote.coffee","app/lib/static_jsonp.coffee","app/models/map.coffee","app/models/nav.coffee"],"names":[],"mappings":"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","sourcesContent":["$ ->\n  require 'lib/first_timer'\n  require 'lib/regexp_quote'\n  require 'lib/static_jsonp'\n\n  mapMod = require 'models/map'\n  navMod = require 'models/nav'\n","# functions to GET JSON\n\ngetJSON = (url, success, error=null) ->\n  console.log(\"getJSON: #{url}\")\n  $.ajax\n    dataType: \"json\",\n    url: url,\n    success: success\n    error: error\n\ngetDeferredJSON = (url, opts={} )->\n  d = $.Deferred()\n  getJSON url,\n    ((data)->\n      if opts.post_fn\n        d.resolve opts.post_fn(data)\n      else\n        d.resolve data),\n    (()->d.reject())\n  d.promise()\n\nexports.getJSON = getJSON\nexports.getDeferredJSON = getDeferredJSON\n","# functions for the JSON API\n\najax = require 'lib/ajax'\n\nget = (url, success, error=null)->\n  d = $.Deferred()\n\n  ajax.getJSON url,\n    ((response)->d.resolve response.data),\n    (()->d.reject())\n\n  d\n\nexports.get = get\n","visited = $.cookie('visited')\n\nif !visited\n  $('#firsttimer').modal(show: true)\n\n$('#firsttimer .close').on 'click', ()->\n  $('#firsttimer').hide 200, ()->\n    $.cookie('visited', expires: 365)\n","RegExp.quote = (str,opts='')->\n  str.replace(/([.?*+^$[\\]\\\\(){}|-])/g, \"\\\\$1\")\n","# implements static JSONP with a promises interface\n\nidDeferreds = {}\n\nrequest = (id, url, options={})->\n  throw new Error(\"no id\") if !id\n\n  deferred = $.Deferred()\n  idDeferreds[id] = deferred\n\n  requestOpts =\n    crossDomain: true\n    dataType: 'jsonp'\n    cache: if _.has(options, 'cache') then options.cache else true\n    jsonp: false\n    jsonpCallback: ''\n\n  console.log \"JSONP: requesting: #{id} from: #{url}\"\n  try\n    $.ajax url, requestOpts\n\n    # JSONP has no error callback, so timeout after options.timeout or 30s\n    setTimeout (()->\n      if deferred.state()=='pending'\n        console.log \"JSONP: timing out request id: #{id}, url: #{url}\"\n        deferred.reject()\n      idDeferreds[id] = null if idDeferreds[id] == deferred),\n      options.timeout || 30000\n  catch error\n    console.log error\n    deferred.reject()\n    idDeferreds[id] = null if idDeferreds[id] == deferred\n\n\n  deferred.promise()\n\nresponse = (id, data)->\n  deferred = idDeferreds[id]\n  idDeferreds[id] = null\n\n  if deferred\n    deferred.resolve(data)\n    deferred.promise()\n  else\n    console.log \"JSONP: response for id: #{id} received,\n      but no deferred registered\"\n\nexports.request = request\nexports.response = response\n\nwindow.staticJsonpResponse = response\n","map = L\n  .mapbox\n  .map('map', 'mccraigmccraig.map-gqkcbi1g')\n  .fitBounds([\n    [61,2.5],\n    [48.7,-11.5]],\n    {paddingTopLeft: [0,0], paddingBottomRight: [0,0]})\n\n# pan the map to show all the bounds given\npanToShow = (all_bounds...)->\n  fb = _.first(all_bounds)\n  fb_copy = new L.LatLngBounds(fb.getSouthWest(), fb.getNorthEast())\n\n  super_bounds = _.reduce all_bounds, ((sb, bounds)->\n    sb.extend bounds),\n    fb_copy\n\n  map.fitBounds(super_bounds) # unless map.getBounds().contains(super_bounds)\n\n  if all_bounds.length == 1\n    map.setZoom( map.getZoom() - 1)\n\nexports.map = map\nexports.panToShow = panToShow\n","$('#nav .search > a').on 'click', (e)->\n  e.preventDefault()\n  $(this).parent().toggleClass('open')\n  $('#search').toggle()\n\n$('#nav .map > a, #nav .lists > a').on 'click', (e)->\n  e.preventDefault()\n  li = $(this).parent()\n  li.addClass('active').siblings('.active').removeClass('active')\n  if li.is('.map')\n    $('body').removeClass().addClass('view-map')\n  else\n    $('body').removeClass().addClass('view-lists')\n\n$('#search button').on 'click', ()->\n  $('#search input').val('').focus()\n\n$('#map-report > a').on 'click', (e)->\n  e.preventDefault()\n  map = $('#map-report')\n  if map.hasClass('open')\n    $('#map-report').animate {right: '-270px'}, 400, ()->\n      $(this).removeClass('open')\n  else\n    $('#map-report').animate {right: '0'}, 400, ()->\n      $(this).addClass('open')\n"]}